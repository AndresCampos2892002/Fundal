<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Postulaciones Archivadas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="/css/navbarStyles.css" rel="stylesheet">

    <link href="/css/postulaciones.css" rel="stylesheet">
</head>
<body>
    <%- include('navbar') %>

    <div class="container mt-4 mb-5">
        <div class="page-header">
            <h2>Postulaciones Archivadas</h2>
            <div class="page-actions">
                <a href="/postulaciones" class="btn">
                    <i class="fas fa-arrow-left me-2"></i>Volver a Postulaciones Activas
                </a>
            </div>
        </div>

        <% if (success_msg && success_msg.length > 0) { %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <%= success_msg %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>
        <% if (error_msg && error_msg.length > 0) { %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <%= error_msg %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>

        <div class="main-card">
            <div class="table-wrapper">
                <table class="table align-middle">
                    <thead>
                        <tr class="text-nowrap">
                            <th>#</th>
                            <th>Nombre niño</th>
                            <th>Fecha Visita</th>
                            <th>Contacto Principal</th>
                            <th>Medio</th>
                            <th>Estado</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (postulaciones.length > 0) { %>
                            <% postulaciones.forEach(p => { %>
                                <tr>
                                    <td><small class="text-muted"><%= p.id %></small></td>
                                    <td><strong><%= p["nombre_niño"] %></strong></td>
                                    <td>
                                        <% if (p.fecha_visita) { %>
                                            <%= new Date(p.fecha_visita).toLocaleDateString('es-GT') %>
                                        <% } else { %>--<% } %>
                                    </td>
                                    <td>
                                        <%= p.nombre_madre || p.nombre_padre || 'No especificado' %>
                                        <br>
                                        <small class="text-muted"><%= p.telefono || p.telefono_padre || '--' %></small>
                                    </td>
                                    <td><%= p.medio_comunicacion || '--' %></td>
                                    <td>
                                        <span class="badge bg-secondary"><%= p.estado %></span>
                                    </td>
                                    <td class="text-end">
                                        <div class="action-buttons">
                                            <form action="/postulaciones/restaurar/<%= p.id %>" method="POST" class="d-inline-block" onsubmit="return confirm('¿Restaurar esta postulación a la lista de activas?')">
                                                <button class="btn" title="Restaurar Postulación">
                                                    <i class="fas fa-undo text-success"></i>
                                                </button>
                                            </form>
                                            <form action="/postulaciones/eliminar/<%= p.id %>" method="POST" class="d-inline-block" onsubmit="return confirm('¡ADVERTENCIA! ¿Desea eliminar esta postulación permanentemente?')">
                                                <button class="btn" title="Eliminar Permanentemente">
                                                    <i class="fas fa-trash-alt text-danger"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="7" class="text-center text-muted p-5">No hay postulaciones archivadas.</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</body>
</html>