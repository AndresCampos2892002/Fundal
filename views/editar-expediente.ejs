<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Expediente de <%= expediente.nombre_completo %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="/css/postulaciones.css" rel="stylesheet">
  <link href="/css/navbarStyles.css" rel="stylesheet">
</head>
<body>
  <%- include('navbar') %>

  <div class="container mt-5 mb-5">
    <div class="page-header">
      <h2>✏️ Editar Expediente de: <%= expediente.nombre_completo %></h2>
      <a href="/expedientes/<%= expediente.id %>" class="btn btn-outline-secondary"><i class="fas fa-times me-2"></i>Cancelar</a>
    </div>

    <% if (success_msg && success_msg.length > 0) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= success_msg %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>
    <% if (error_msg && error_msg.length > 0) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error_msg %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <form action="/expedientes/editar/<%= expediente.id %>" method="POST">
      <div class="main-card">

        <h5 class="mb-3">1. Datos Generales</h5>
        <div class="row g-3">
          <div class="col-md-4"><label class="form-label">Código FUNDAL*</label><input type="text" name="codigo" class="form-control" value="<%= expediente.codigo %>" required></div>
          <div class="col-md-8"><label class="form-label">Nombre Completo*</label><input type="text" name="nombre_completo" class="form-control" value="<%= expediente.nombre_completo %>" required></div>
          <div class="col-md-4"><label class="form-label">Fecha de Nacimiento*</label><input type="date" name="fecha_nacimiento" class="form-control" value="<%= expediente.fecha_nacimiento ? new Date(expediente.fecha_nacimiento).toISOString().slice(0, 10) : '' %>" required></div>
          <div class="col-md-4"><label class="form-label">Edad</label><input type="number" name="edad" class="form-control" value="<%= expediente.edad || '' %>"></div>
          <div class="col-md-4"><label class="form-label">Género*</label><select name="genero" class="form-select" required><option value="Masculino" <%= expediente.genero === 'Masculino' ? 'selected' : '' %>>Masculino</option><option value="Femenino" <%= expediente.genero === 'Femenino' ? 'selected' : '' %>>Femenino</option></select></div>
          <div class="col-md-4"><label class="form-label">ID Partida Nacimiento*</label><input type="text" name="id_partida_nacimiento" class="form-control" value="<%= expediente.id_partida_nacimiento %>" required></div>
          <div class="col-md-4"><label class="form-label">Departamento*</label><input type="text" name="departamento" class="form-control" value="<%= expediente.departamento %>" required></div>
          <div class="col-md-4"><label class="form-label">Municipio*</label><input type="text" name="municipio" class="form-control" value="<%= expediente.municipio %>" required></div>
          <div class="col-md-4"><label class="form-label">Aldea/Comunidad*</label><input type="text" name="aldea" class="form-control" value="<%= expediente.aldea %>" required></div>
          <div class="col-md-4"><label class="form-label">Sede*</label><input type="text" name="sede" class="form-control" value="<%= expediente.sede %>" required></div>
          <div class="col-md-4"><label class="form-label">Referido por</label><input type="text" name="referido_por" class="form-control" value="<%= expediente.referido_por || '' %>"></div>
        </div>
        <hr class="my-4">

        <h5 class="mb-3">2. Información Médica y Administrativa</h5>
        <div class="row g-3">
          <div class="col-md-4"><label class="form-label">Código MINEDUC</label><input type="text" name="codigo_mineduc" class="form-control" value="<%= expediente.codigo_mineduc || '' %>"></div>
          <div class="col-md-4"><label class="form-label">Dificultad Socioeconómica*</label><select name="dificultad_socioeconomica" class="form-select" required><option value="Alta" <%= expediente.dificultad_socioeconomica === 'Alta' ? 'selected' : '' %>>Alta</option><option value="Media" <%= expediente.dificultad_socioeconomica === 'Media' ? 'selected' : '' %>>Media</option><option value="Baja" <%= expediente.dificultad_socioeconomica === 'Baja' ? 'selected' : '' %>>Baja</option></select></div>
          <div class="col-12"><label class="form-label">Diagnóstico</label><textarea name="diagnostico" class="form-control" rows="2"><%= expediente.diagnostico || '' %></textarea></div>
          <div class="col-12"><label class="form-label">Discapacidad*</label><textarea name="discapacidad" class="form-control" rows="2" required><%= expediente.discapacidad %></textarea></div>
          <div class="col-md-4"><label class="form-label">Fecha de Evaluación*</label><input type="date" name="fecha_evaluacion" class="form-control" value="<%= expediente.fecha_evaluacion ? new Date(expediente.fecha_evaluacion).toISOString().slice(0, 10) : '' %>" required></div>
          <div class="col-md-4"><label class="form-label">Fecha Ingreso a Fundal*</label><input type="date" name="fecha_ingreso_fundal" class="form-control" value="<%= expediente.fecha_ingreso_fundal ? new Date(expediente.fecha_ingreso_fundal).toISOString().slice(0, 10) : '' %>" required></div>
          <div class="col-md-4"><label class="form-label">Fecha Ingreso MSPAS*</label><input type="date" name="fecha_ingreso_mspas" class="form-control" value="<%= expediente.fecha_ingreso_mspas ? new Date(expediente.fecha_ingreso_mspas).toISOString().slice(0, 10) : '' %>" required></div>
        </div>
        <hr class="my-4">

        <h5 class="mb-3">3. Representante Legal y Auxiliar</h5>
        <div class="row g-3">
          <div class="col-md-6"><label class="form-label">Nombre del Representante</label><input type="text" name="representante_nombre" class="form-control" value="<%= expediente.representante_nombre || '' %>"></div>
          <div class="col-md-6"><label class="form-label">DPI</label><input type="text" name="representante_dpi" class="form-control" value="<%= expediente.representante_dpi || '' %>"></div>
          <div class="col-md-4"><label class="form-label">Estado Civil</label><select name="estado_civil" class="form-select"><option value="Soltero/a" <%= expediente.estado_civil === 'Soltero/a' ? 'selected' : '' %>>Soltero/a</option><option value="Casado/a" <%= expediente.estado_civil === 'Casado/a' ? 'selected' : '' %>>Casado/a</option></select></div>
          <div class="col-md-4"><label class="form-label">Parentesco</label><input type="text" name="representante_parentesco" class="form-control" value="<%= expediente.representante_parentesco || '' %>"></div>
          <div class="col-md-4"><label class="form-label">Teléfono</label><input type="text" name="representante_telefono" class="form-control" value="<%= expediente.representante_telefono || '' %>"></div>
          <div class="col-12"><label class="form-label">Dirección</label><input type="text" name="representante_direccion" class="form-control" value="<%= expediente.representante_direccion || '' %>"></div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-md-6"><label class="form-label">Nombre del Auxiliar (Opcional)</label><input type="text" name="auxiliar_nombre" class="form-control" value="<%= expediente.auxiliar_nombre || '' %>"></div>
          <div class="col-md-6"><label class="form-label">Teléfono del Auxiliar</label><input type="text" name="auxiliar_telefono" class="form-control" value="<%= expediente.auxiliar_telefono || '' %>"></div>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-save me-2"></i>Guardar Cambios
          </button>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>